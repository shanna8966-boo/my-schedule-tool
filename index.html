<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<title>è¡Œç¨‹ç®¡ç†å·¥å…· - Shanna ç‰ˆ</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    body {
        font-family: Arial;
        max-width: 700px;
        margin: auto;
        padding: 40px;
    }
</style>
</head>

<body>
<h2>ğŸ“… è¡Œç¨‹ç®¡ç†å·¥å…·ï¼ˆCSV â†’ ä»Šæ—¥è¡Œç¨‹ + åˆ†é¡åœ“é¤…åœ–ï¼‰</h2>

<input type="file" id="fileInput" accept=".csv" />
<button onclick="processCSV()">é–‹å§‹åˆ†æ</button>

<hr>

<h3>ğŸ“ ä»Šæ—¥è¡Œç¨‹è¡¨</h3>
<div id="schedule"></div>

<h3>ğŸ“Š ä»Šæ—¥åˆ†é¡åœ“é¤…åœ–</h3>
<canvas id="pieChart"></canvas>

<script>
function processCSV() {
    const file = document.getElementById("fileInput").files[0];
    if (!file) return alert("è«‹å…ˆä¸Šå‚³ CSV");

    const reader = new FileReader();
    reader.onload = function(e) {
        const lines = e.target.result.split("\n").map(l => l.trim());
        const today = new Date().toISOString().split("T")[0];

        let events = [];
        for (let i = 1; i < lines.length; i++) {
            const [date, start, end, title, category] = lines[i].split(",");
            if (date === today) {
                const duration =
                    (new Date(`${date}T${end}`) - new Date(`${date}T${start}`)) / 60000;
                events.push({ start, end, title, category, duration });
            }
        }

        // æ¸²æŸ“è¡Œç¨‹è¡¨
        const scheduleDiv = document.getElementById("schedule");
        scheduleDiv.innerHTML = "";
        events.forEach(ev => {
            scheduleDiv.innerHTML += `
                <div>
                    <strong>${ev.start} - ${ev.end}</strong>ï¼š${ev.title}
                    ï¼ˆåˆ†é¡ï¼š${ev.category}ï¼‰
                </div>
            `;
        });

        // è¨ˆç®—åˆ†é¡æ¯”ä¾‹
        const categoryMap = {};
        events.forEach(ev => {
            categoryMap[ev.category] = (categoryMap[ev.category] || 0) + ev.duration;
        });

        const labels = Object.keys(categoryMap);
        const dataValues = Object.values(categoryMap);

        // ç”Ÿæˆåœ“é¤…åœ–
        new Chart(document.getElementById("pieChart"), {
            type: "pie",
            data: {
                labels: labels,
                datasets: [{
                    data: dataValues
                }]
            }
        });
    };
    reader.readAsText(file);
}
</script>

</body>
</html>
